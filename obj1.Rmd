---
title: "obj1"
output: html_document
date: "2024-07-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# How do the composite indicators compare against each other?

```{r}
library(tidyverse)
library(ggpubr)
library(table1)


eth<- read.csv("eth_nar.csv")
ind<- read.csv("ind_nar.csv") 
nga<- read.csv("nga_nar.csv")
```

```{r}
# double checking nar calculation is correct
eth %>% 
  group_by(X) %>% 
  mutate(mar2 = sum(vita_rae_nar,
                     folate_nar,
                     vitb12_nar,
                     fe_nar,
                     zn_nar, 
                     thia_nar, 
                     ribo_nar,
                     niac_nar,
                     vitb6_nar)/9) %>% 
  select(mar,mar2) %>% 
  head()
```

## Distributions of MAR and MPA

```{r}
# MAR
# Distribution of MAR values in Ethiopia
ggplot(eth, aes(x=mar))+
  geom_histogram(binwidth = 0.05)+
  theme_minimal()+
  xlim(0,1)+
  labs(x = "MAR", y = "count", title = "Distribution of MAR values in Ethiopia")+
  theme(plot.title = element_text(hjust = 0.5))


# Distribution of MAR values in India
ggplot(ind, aes(x=mar))+
  geom_histogram(binwidth = 0.05)+
  theme_minimal()+
  xlim(0,1)+
  labs(x = "MAR", y = "count", title = "Distribution of MAR values in India")+
  theme(plot.title = element_text(hjust = 0.5))


# Distribution of MAR values in Nigeria
ggplot(nga, aes(x=mar))+
  geom_histogram(binwidth = 0.03)+
  theme_minimal() +
  xlim(0,1)+
  labs(x = "MAR", y = "count", title = "Distribution  of MAR values in Nigeria")+
  theme(plot.title = element_text(hjust = 0.5))

```

## Interpretation

The distribution of mar in every country is **right** skewed.

The majority of each sample has a high MAR value.

Ethiopia and Nigeria have very high counts of high MAR. Nigeria's stepwise distribution suggests a higher number of individuals with increasing MAR values. The majority of each population have diets that are relatively adequate, with many approaching full adequacy.

```{r}
# MPA 
# Distribution of MPA values in Ethiopia
ggplot(eth, aes(x=mpa))+
  geom_histogram()+
  theme_minimal()+
  xlim(0,1)+
  labs(x = "MPA", y = "count", title = "Distribution of MPA values in Ethiopia")+
  theme(plot.title = element_text(hjust = 0.5))


# Distribution of MPA values in India
ggplot(ind, aes(x=mpa))+
  geom_histogram()+
  theme_minimal()+
  xlim(0,1)+
  labs(x = "MPA", y = "count", title = "Distribution of MPA values in India")+
  theme(plot.title = element_text(hjust = 0.5))


# Distribution of MPA values in Nigeria
ggplot(nga, aes(x=mpa))+
  geom_histogram()+
  theme_minimal()+
  xlim(0,1)+
  labs(x = "MPA", y = "count", title = "Distribution of MPA values in Nigeria")+
  theme(plot.title = element_text(hjust = 0.5))
```

## Interpretation

The MPA distributions are far less conventional with peaks and lows. The distributions show a lot of variation in the mean probability of adequacy across the three populations and suggest a degree of variability in meeting nutrient requirements

Ethiopia - More peaks counts for higher MPAs (closer to 1), meaning that on avergae, large numbers of the population are likely to meet nutrient needs.

India & Nigeria - high counts of low MPA (close to 0), decreasing counts for higher MPA. Majority of the population is unlikely to meet their requirement needs. <!-- this is in contrast to MAR - where the majority of the Nigerian population have MAR values close to 1. -->

## Comparing Descruptives (Tables)

```{r}
label(eth$mar) <- "Mean Adequacy Ratio"
label(eth$mpa) <- "Mean Probability of Adequacy"
table1(~mar + mpa | res, data = eth, na.rm = TRUE, digits = 3, format.number = TRUE)

label(ind$mar) <- "Mean Adequacy Ratio"
label(ind$mpa) <- "Mean Probability of Adequacy"
table1(~mar + mpa | res, data = ind, na.rm = TRUE, digits = 3, format.number = TRUE)

label(nga$mar) <- "Mean Adequacy Ratio"
label(nga$mpa) <- "Mean Probability of Adequacy"
table1(~mar + mpa | res, data = nga, na.rm = TRUE, digits = 3, format.numebr = TRUE)

# Focusing on median because of skewed distributions 

# Overall
  # MAR does not vary between countries, however the MPA shows clear differences (e.g. Ethiopia standing out), as reflected in distributions^

# Stratifying sub nationally 
  # MAR slightly higher in urban populations 
  # MPA slightly higher in urban populations (E/N), opposite for I (but note 2x population is rural)
```

```{r}
ethh <- eth %>% 
  mutate(country = "Ethiopia")
indd <- ind %>% 
  mutate(country = "India")
ngaa <- nga %>% 
  mutate(country ="Nigeria")
all <- rbind(ethh, indd, ngaa) %>% drop_na()

table1(~mar + mpa | country, data = all, na.rm = TRUE, digits = 3, format.number = TRUE) 

table1(~mar + mpa | country*res, data = all, na.rm = TRUE, digits = 3, format.number = TRUE, overall = F) 

table1(~mar + mpa | country*sep_quintile, data = all, na.rm = TRUE, digits = 3, format.number = TRUE, overall = F) # steady increase in mar and mpa as sep_quintile increases (as population gets richer)

```

# Plotting MAR and MPA against each other

```{r}
# Ethiopia 
mar_mpa_e <- ggscatter(eth, x = "mar",
                       y = "mpa",
                        alpha = 0.2,
                       add = "reg.line", 
                       add.params = list(color = "red", fill = "lightgray"), 
                       conf.int = TRUE )
mar_mpa_e + stat_cor(method = "spearman",
                p.accuracy = 0.001,
                r.accuracy = 0.01)+
  labs(x = "Mean Adequacy Ratio", y = "Mean Probability of Adequacy")+
  xlim(0, 1)+
  ylim(0, 1)


#India 
mar_mpa_i <- ggscatter(ind, x = "mar", y = "mpa",
                       alpha = 0.2,
                       add = "reg.line", 
                       add.params = list(color = "red", fill = "lightgray"), 
                       conf.int = TRUE )
mar_mpa_i + stat_cor(method = "spearman",
                p.accuracy = 0.001,
                r.accuracy = 0.01)+
  labs(x = "Mean Adequacy Ratio", y = "Mean Probability of Adequacy")+
  xlim(0, 1)+
  ylim(0, 1)

#Nigeria
mar_mpa_n <- ggscatter(nga, x = "mar",
                       y = "mpa",
                       alpha = 0.2,
                       add = "reg.line", 
                       add.params = list(color = "red", fill = "lightgray"), 
                       conf.int = TRUE )
mar_mpa_n + stat_cor(method = "spearman",
                p.accuracy = 0.001,
                r.accuracy = 0.01)+
  labs(x = "Mean Adequacy Ratio", y = "Mean Probability of Adequacy")+
  xlim(0, 1)+
  ylim(0, 1)

# All have very high correlations, suggesting that MAR and MPA are closely aligned - the higher the mean adequacy ratio, the higher the likelihood of meeting nutritional requirements 
```

# How do they compare against each other on a very controlled sample - e.g. controlling for SEP, res etc.. sub national level

```{r}
# Urban vs Rural, Ethiopia
ggplot(eth, aes(x = mar, y = mpa))+
  geom_point()+
  facet_wrap(~res)

# Urban vs Rural, India
ggplot(ind, aes(x = mar, y = mpa))+
  geom_point()+
  facet_wrap(~res)

# Urban vs Rural, Nigeria
ggplot(nga, aes(x = mar, y = mpa))+
  geom_point()+
  facet_wrap(~res)

# All the distributions look quite different but in each country, similar

```
